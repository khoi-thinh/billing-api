name: Billing API CI/CD

on:
  push:
    branches:
      - main
      - 'feature/**'

jobs:
  deploy-dev:
    if: startsWith(github.ref_name, 'feature/')
    uses: khoi-thinh/ci-cd-templates/.github/workflows/node-ec2.yaml@v5
    with:
      app_name: billing-api
      deploy_path: /opt/billing-api
      environment: dev
    secrets:
      EC2_HOST: ${{ secrets.DEV_EC2_HOST }}
      EC2_USER: ${{ secrets.EC2_USER }}
      EC2_SSH_KEY: ${{ secrets.EC2_SSH_KEY }}

  deploy-prod:
    if: github.ref_name == 'main'
    uses: khoi-thinh/ci-cd-templates/.github/workflows/node-ec2.yaml@v5
    with:
      app_name: billing-api
      deploy_path: /opt/billing-api
      environment: production
    secrets:
      EC2_HOST: ${{ secrets.PROD_EC2_HOST }}
      EC2_USER: ${{ secrets.EC2_USER }}
      EC2_SSH_KEY: ${{ secrets.EC2_SSH_KEY }}

